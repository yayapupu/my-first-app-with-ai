<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>噗噗 Binance 事件合約預測器</title>
  <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/browser.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    select, button {
      margin: 10px;
      padding: 5px;
    }
    #result, #details {
      margin-top: 20px;
      padding: 10px;
      border-radius: 6px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #details {
      white-space: pre-wrap;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>噗噗 Binance 事件合約預測器 (10/30分鐘)</h1>
  <label for="symbol">選擇幣種:</label>
  <select id="symbol">
    <option value="BTCUSDT">比特幣 (BTC)</option>
    <option value="ETHUSDT">以太幣 (ETH)</option>
  </select>

  <label for="interval">時間尺度:</label>
  <select id="interval">
    <option value="10m">10分鐘</option>
    <option value="30m">30分鐘</option>
  </select>

  <button onclick="analyzeMarket()">分析</button>

  <div id="result"></div>
  <div id="details"></div>

  <script>
    async function analyzeMarket() {
      const symbol = document.getElementById("symbol").value;
      const interval = document.getElementById("interval").value;
      const limit = interval === "10m" ? 50 : 100;

      const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1m&limit=${limit}`);
      const data = await res.json();

      const close = data.map(c => parseFloat(c[4]));
      const high = data.map(c => parseFloat(c[2]));
      const low = data.map(c => parseFloat(c[3]));

      const time = new Date().toLocaleString();

      // MACD
      const macd = window.technicalindicators.MACD.calculate({
        values: close,
        fastPeriod: 12,
        slowPeriod: 26,
        signalPeriod: 9,
        SimpleMAOscillator: false,
        SimpleMASignal: false
      });
      const latestMACD = macd[macd.length - 1];
      const macdSignal = latestMACD.MACD > latestMACD.signal ? "看漲" : latestMACD.MACD < latestMACD.signal ? "看跌" : "盤整";

      // RSI
      const rsi = window.technicalindicators.RSI.calculate({ values: close, period: 14 });
      const latestRSI = rsi[rsi.length - 1];
      const rsiSignal = latestRSI > 70 ? "看跌" : latestRSI < 30 ? "看漲" : "盤整";

      // KDJ (Stochastic)
      const kdj = window.technicalindicators.Stochastic.calculate({
        high,
        low,
        close,
        period: 14,
        signalPeriod: 3
      });
      const latestKDJ = kdj[kdj.length - 1];
      const kdjSignal = latestKDJ.k > latestKDJ.d ? "看漲" : latestKDJ.k < latestKDJ.d ? "看跌" : "盤整";

      // Bollinger Bands
      const bb = window.technicalindicators.BollingerBands.calculate({
        values: close,
        period: 20,
        stdDev: 2
      });
      const latestBB = bb[bb.length - 1];
      const lastPrice = close[close.length - 1];
      let bbSignal = "盤整";
      if (lastPrice >= latestBB.upper) bbSignal = "看跌";
      else if (lastPrice <= latestBB.lower) bbSignal = "看漲";

      // 統合分析
      let bullish = 0, bearish = 0;
      if (macdSignal === "看漲") bullish++; else if (macdSignal === "看跌") bearish++;
      if (rsiSignal === "看漲") bullish++; else if (rsiSignal === "看跌") bearish++;
      if (kdjSignal === "看漲") bullish++; else if (kdjSignal === "看跌") bearish++;
      if (bbSignal === "看漲") bullish++; else if (bbSignal === "看跌") bearish++;

      let final = "盤整中，不宜入場 🚫";
      if (bullish >= 3) final = `預測 ${interval} 後 ${symbol} 將上漲 📈`;
      else if (bearish >= 3) final = `預測 ${interval} 後 ${symbol} 將下跌 📉`;

      document.getElementById("result").innerText = `分析結果：${final}`;

      document.getElementById("details").innerText =
        `分析時間：${time}\n` +
        `→ MACD (${macdSignal}): MACD=${latestMACD.MACD.toFixed(3)}, signal=${latestMACD.signal.toFixed(3)}\n` +
        `→ RSI (${rsiSignal}): RSI=${latestRSI.toFixed(2)}\n` +
        `→ KDJ (${kdjSignal}): K=${latestKDJ.k.toFixed(2)}, D=${latestKDJ.d.toFixed(2)}\n` +
        `→ 布林通道 (${bbSignal}): 價格=${lastPrice.toFixed(2)}, 上=${latestBB.upper.toFixed(2)}, 下=${latestBB.lower.toFixed(2)}`;
    }
  </script>
</body>
</html>
